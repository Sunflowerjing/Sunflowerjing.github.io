(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{307:function(e,s,v){"use strict";v.r(s);var t=v(0),_=Object(t.a)({},(function(){var e=this,s=e.$createElement,v=e._self._c||s;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"package文件学习"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#package文件学习"}},[e._v("#")]),e._v(" package文件学习")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("browser")]),e._v(" VS "),v("code",[e._v("module")]),e._v(" VS "),v("code",[e._v("main")]),e._v(" "),v("ul",[v("li",[e._v("在"),v("code",[e._v("不同环境")]),e._v("下 "),v("code",[e._v("import 一个 npm 包")]),e._v("时, 加载的是 "),v("code",[e._v("npm 包")]),e._v(" 中哪个文件? "),v("code",[e._v("main 字段中指定的文件")])]),e._v(" "),v("li",[e._v("npm 包分为: 只允许在"),v("code",[e._v("客户端")]),e._v("使用的，只允许在"),v("code",[e._v("服务端")]),e._v("使用的，"),v("code",[e._v("浏览器/服务端")]),e._v("都可以使用。")]),e._v(" "),v("li",[e._v("开发一个 npm 包, 同时兼容支持 "),v("code",[e._v("web端")]),e._v(" 和 "),v("code",[e._v("server端")]),e._v("。需要在"),v("code",[e._v("不同环境下, 加载npm包的不同入口文件。")]),e._v("所以衍生出来: "),v("code",[e._v("module")]),e._v(" 和 "),v("code",[e._v("browser")]),e._v("字段.")])])])]),e._v(" "),v("h2",{attrs:{id:"文件优先级"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#文件优先级"}},[e._v("#")]),e._v(" 文件优先级")]),e._v(" "),v("ul",[v("li",[e._v("模块规范有 "),v("code",[e._v("ESM")]),e._v(" 和 "),v("code",[e._v("commonJS")]),e._v(" 两种。")]),e._v(" "),v("li",[e._v("为了能 "),v("code",[e._v("在node环境")]),e._v(" 下原生执行 "),v("code",[e._v("ESM")]),e._v(" 规范的脚本文件，"),v("code",[e._v(".mjs")]),e._v(" 文件就应运而生。")]),e._v(" "),v("li",[e._v("当存在 "),v("code",[e._v("index.mjs")]),e._v(" 和 "),v("code",[e._v("index.js")]),e._v(" 这种同名不同后缀的文件时，"),v("code",[e._v("import './index'")]),e._v(" 或者 "),v("code",[e._v("require('./index')")]),e._v(" 是会优先加载 "),v("code",[e._v("index.mjs")]),e._v(" 文件的。")]),e._v(" "),v("li",[e._v("也就是说，优先级 "),v("code",[e._v("mjs > js")])])]),e._v(" "),v("h2",{attrs:{id:"browser，module-和-main-字段"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#browser，module-和-main-字段"}},[e._v("#")]),e._v(" browser，module 和 main 字段")]),e._v(" "),v("h3",{attrs:{id:"字段定义"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#字段定义"}},[e._v("#")]),e._v(" 字段定义")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("main")]),e._v(": 定义了 "),v("code",[e._v("npm")]),e._v(" 包的入口文件，"),v("code",[e._v("browser 环境和 node 环境")]),e._v("均可使用。")]),e._v(" "),v("li",[v("code",[e._v("module")]),e._v(": 定义 "),v("code",[e._v("npm")]),e._v(" 包的 ESM 规范的入口文件，"),v("code",[e._v("browser 环境和 node 环境")]),e._v("均可使用。")]),e._v(" "),v("li",[v("code",[e._v("browser")]),e._v(": 定义 "),v("code",[e._v("npm")]),e._v(" 包在 "),v("code",[e._v("browser 环境")]),e._v("下的入口文件。")])]),e._v(" "),v("h3",{attrs:{id:"使用场景与优先级"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#使用场景与优先级"}},[e._v("#")]),e._v(" 使用场景与优先级")]),e._v(" "),v("ul",[v("li",[e._v("例如: npm 包 test 有以下目录结构")])]),e._v(" "),v("div",{staticClass:"language-javascript extra-class"},[v("pre",{pre:!0,attrs:{class:"language-javascript"}},[v("code",[v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v(" lib\n   "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v(" index"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("browser"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("js\n   "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v(" index"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("browser"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("mjs\n   "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v(" index"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("js\n   "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v(" index"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("mjs\n")])])]),v("ul",[v("li",[e._v("其中 "),v("code",[e._v("*.js")]),e._v(" 文件是使用 commonJS 规范的语法("),v("code",[e._v("require('xxx')")]),e._v(")，"),v("code",[e._v("*.mjs")]),e._v(" 是用 ESM 规范的语法("),v("code",[e._v("import 'xxx'")]),e._v(")")]),e._v(" "),v("li",[e._v("其 "),v("code",[e._v("package.json")]),e._v(" 文件:")])]),e._v(" "),v("div",{staticClass:"language-javascript extra-class"},[v("pre",{pre:!0,attrs:{class:"language-javascript"}},[v("code",[v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"main"')]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"lib/index.js"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("  "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// main ")]),e._v("\n"),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"module"')]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"lib/index.mjs"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// module")]),e._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// browser 可定义成和 main/module 字段一一对应的映射对象，也可以直接定义为字符串")]),e._v("\n"),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"browser"')]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"./lib/index.js"')]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"./lib/index.browser.js"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// browser+cjs")]),e._v("\n    "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"./lib/index.mjs"')]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"./lib/index.browser.mjs"')]),e._v("  "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// browser+mjs")]),e._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v('// "browser": "./lib/index.browser.js" // browser')]),e._v("\n")])])]),v("ul",[v("li",[e._v("根据上述配置, package.json 指定的入口可以有: 以下5种\n"),v("ul",[v("li",[v("code",[e._v("main")])]),e._v(" "),v("li",[v("code",[e._v("module")])]),e._v(" "),v("li",[v("code",[e._v("browser")])]),e._v(" "),v("li",[v("code",[e._v("browser+cjs")])]),e._v(" "),v("li",[v("code",[e._v("browser+mjs")])])])])]),e._v(" "),v("h4",{attrs:{id:"webpack-web-esm"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#webpack-web-esm"}},[e._v("#")]),e._v(" webpack + web + ESM")]),e._v(" "),v("ul",[v("li",[e._v("最常见的使用场景，通过 "),v("code",[e._v("webpack")]),e._v(" 打包构建我们的 "),v("code",[e._v("web 应用")]),e._v("，模块语法使用 "),v("code",[e._v("ESM")])]),e._v(" "),v("li",[e._v("使用方式: "),v("code",[e._v("import test from 'test'")])]),e._v(" "),v("li",[e._v("实际上加载优先级是 "),v("code",[e._v("browser = browser+mjs > module > browser+cjs > main")]),e._v(", 也就是说 "),v("code",[e._v("webpack")]),e._v(" 会根据这个顺序去寻找字段指定的文件，直到找到为止。")]),e._v(" "),v("li",[e._v("参考流程图:\n"),v("img",{attrs:{src:"%E6%A8%A1%E5%9D%97.png",alt:"webpack + web + ESM"}})])]),e._v(" "),v("h4",{attrs:{id:"webpack-web-commonjs"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#webpack-web-commonjs"}},[e._v("#")]),e._v(" webpack + web + commonJS")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("const test = require('test')")])]),e._v(" "),v("li",[e._v("构建 web 应用时，使用 "),v("code",[e._v("ESM 或者 commonJS 模块")]),e._v("规范对于加载优先级并没有任何影响")]),e._v(" "),v("li",[e._v("优先级依然是 "),v("code",[e._v("browser = browser+mjs > module > browser+cjs > main")])])]),e._v(" "),v("h4",{attrs:{id:"webpack-node-esm-commonjs"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#webpack-node-esm-commonjs"}},[e._v("#")]),e._v(" webpack + node + ESM/commonJS")]),e._v(" "),v("ul",[v("li",[e._v("使用 "),v("code",[e._v("webpack 构建项目")]),e._v("的时候，有一个 "),v("code",[e._v("target")]),e._v(" 选项，默认为 web，即进行 web 应用构建。")]),e._v(" "),v("li",[e._v("当需要进行一些 "),v("code",[e._v("同构项目")]),e._v("，或者"),v("code",[e._v("其他 node 项目")]),e._v("的构建的时候，我们需要将 "),v("code",[e._v("webpack.config.js")]),e._v(" 的"),v("code",[e._v("target")]),e._v(" 选项设置为 "),v("code",[e._v("node")]),e._v(" 进行构建。")]),e._v(" "),v("li",[v("code",[e._v("import test from 'test'")]),e._v("  或者 "),v("code",[e._v("const test = require('test')")])]),e._v(" "),v("li",[e._v("优先级是： "),v("code",[e._v("module > main")])])]),e._v(" "),v("h4",{attrs:{id:"node-commonjs"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#node-commonjs"}},[e._v("#")]),e._v(" node + commonJS")]),e._v(" "),v("ul",[v("li",[e._v("通过 "),v("code",[e._v("node test.js")]),e._v(" 直接执行脚本")]),e._v(" "),v("li",[v("code",[e._v("const test = require('test')")])]),e._v(" "),v("li",[e._v("只有 "),v("code",[e._v("main")]),e._v(" 字段有效。")])]),e._v(" "),v("h4",{attrs:{id:"node-esm"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#node-esm"}},[e._v("#")]),e._v(" node + ESM")]),e._v(" "),v("ul",[v("li",[e._v("通过 "),v("code",[e._v("--experimental-modules")]),e._v(" 可以让 "),v("code",[e._v("node")]),e._v(" 执行 ESM 规范的脚本(必须是 mjs 文件后缀)"),v("code",[e._v("node --experimental-modules test.mjs")])]),e._v(" "),v("li",[v("code",[e._v("import test from 'test'")])]),e._v(" "),v("li",[e._v("只有 "),v("code",[e._v("main")]),e._v(" 字段有效。")])]),e._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),v("ul",[v("li",[e._v("如果 "),v("code",[e._v("npm")]),e._v(" 包导出的是 "),v("code",[e._v("ESM 规范的包")]),e._v("，使用 "),v("code",[e._v("module")])]),e._v(" "),v("li",[e._v("如果 "),v("code",[e._v("npm")]),e._v(" 包只在 "),v("code",[e._v("web 端")]),e._v("使用，并且"),v("code",[e._v("严禁在 server 端")]),e._v("使用，使用 "),v("code",[e._v("browser")])]),e._v(" "),v("li",[e._v("如果 "),v("code",[e._v("npm")]),e._v(" 包只在 "),v("code",[e._v("server 端")]),e._v("使用，使用 "),v("code",[e._v("main")])]),e._v(" "),v("li",[e._v("如果 "),v("code",[e._v("npm")]),e._v(" 包在 "),v("code",[e._v("web 端")]),e._v("和 "),v("code",[e._v("server 端")]),e._v("都允许使用，使用 "),v("code",[e._v("browser 和 main")])])])])}),[],!1,null,null,null);s.default=_.exports}}]);