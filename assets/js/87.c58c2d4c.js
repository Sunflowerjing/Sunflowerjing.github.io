(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{269:function(e,n,t){"use strict";t.r(n);var s=t(0),a=Object(s.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"微信小程序图片上传、预览、删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序图片上传、预览、删除"}},[e._v("#")]),e._v(" 微信小程序图片上传、预览、删除")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  // 选择图片点击\n  chooseImage:function(){ \n    let that = this;\n    wx.chooseImage({   // 从本地相册选择图片或使用相机拍照。\n      count: 9, // 默认9,即最多上传9张\n      sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有\n      sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有\n      success: function (res) {\n        // 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片\n        var tempFilePaths = res.tempFilePaths\n        let imgs = that.data.imgs;\n        for(let i =0; i < tempFilePaths.length; i++){\n          imgs.push(tempFilePaths[i])\n        }\n        that.setData({\n          imgs: imgs\n        })\n      }\n    });\n  },\n  // 预览图片\n  previewImage:function(e){\n    let _index = e.currentTarget.dataset.index;  // 获取自定义数据\n    let list = this.data.imgs;\n    let current = list[_index]; \n    wx.previewImage({\n      current: current, // 当前显示图片的http链接\n      urls: list // 需要预览的图片http链接列表\n    })\n  },\n  // 删除图片\n  delImage:function(e){\n    let _index = e.currentTarget.dataset.index;\n    let previewImage = this.data.imgs;\n    previewImage.splice(_index, 1);   // 删除图片\n    this.setData({\n      imgs: previewImage\n    })\n  },\n  // 上传图片\n  uploadImage:function(e){\n    let imgs = this.data.imgs;\n    const openId = this.data.openId;\n    for (let i = 0; i < imgs.length; i++){\n      wx.uploadFile({  // 将本地资源上传到服务器\n        url: 'https://192.168.1.10:9000/RegisteruserCtr/pois?v=1', //接口地址\n        method: 'POST',\n        header: {\n          'content-type': 'multipart/form-data',\n          openId\n        },\n        filePath: imgs[i],  // 要上传文件资源的路径\n        name: 'nameKey',    // 文件对应的 key，开发者在服务端可以通过这个 key 获取文件的二进制内容\n        success: function (res) {\n          if(res.status === 0){\n            wx.showToast({  // 显示消息提示框\n              title: '上传成功',\n              icon: 'success',\n              duration: 2000\n            })\n          }else{\n            wx.showToast({\n              title: '上传失败',\n              icon: 'none',\n              duration: 2000\n            })\n          }\n        }\n      })\n    }\n    this.setData({\n      layer: !this.data.layer,   // 关闭蒙层\n      imgs: []  // 清空显示数据\n    });\n    wx.showTabBar({\n      animation: true\n    });\n  }\n")])])]),t("h2",{attrs:{id:"小程序实现保存网络图片到本地"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小程序实现保存网络图片到本地"}},[e._v("#")]),e._v(" 小程序实现保存网络图片到本地")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(' wx.getSetting({\n    success(res) {\n        wx.downloadFile({\n        url:"http://mss.sankuai.com/v1/mss_51a7233366a4427fa6132a6ce72dbe54/newsPicture/05558951-de60-49fb-b674-dd906c8897a6",\n            success: function(res) {\n                console.log(res);\n                wx.saveImageToPhotosAlbum({\n                    filePath: res.tempFilePath,\n                    success: function(data) {\n                        wx.showToast({\n                            title: "保存成功",\n                            icon: "success",\n                            duration: 2000\n                        });\n                    },\n                    fail: function(err) {\n                        console.log(err);\n                    },\n                    complete(res) {\n                        console.log(res);\n                    }\n                });\n            }\n        });\n    }\n});\n')])])]),t("h2",{attrs:{id:"读文件中的内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读文件中的内容"}},[e._v("#")]),e._v(" 读文件中的内容")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("读文件的时候需要注意。js、wxss、json、wxml, 这些都是保留后缀，不支持读取。\n\nconst FileSystemManager = wx.getFileSystemManager();\n// readFileSync  readFile\nFileSystemManager.readFile({ //读文件\n// filePath: wx.env.USER_DATA_PATH + \"/\" + 'pages/index/fileName.txt',\n    filePath: '/pages/index/fileName.txt',\n    encoding: 'utf-8',\n    success(res) {\n        if (res.data) {\n        let obj = JSON.parse(res.data);\n        console.log('成功数据', obj);\n        }\n    },\n    fail(err) {\n        console.log('读取失败', err)\n    }\n})\n")])])])])}),[],!1,null,null,null);n.default=a.exports}}]);