<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>输入网址后发生了什么 | Sunflower</title>
    <meta name="description" content="Vuepress blog demo">
    
    
    <link rel="preload" href="/assets/css/0.styles.a32d750b.css" as="style"><link rel="preload" href="/assets/js/app.0c4e457a.js" as="script"><link rel="preload" href="/assets/js/2.3676e543.js" as="script"><link rel="preload" href="/assets/js/99.36965454.js" as="script"><link rel="prefetch" href="/assets/js/10.f6453fe8.js"><link rel="prefetch" href="/assets/js/100.0199c719.js"><link rel="prefetch" href="/assets/js/101.a7de43f8.js"><link rel="prefetch" href="/assets/js/102.50f8644c.js"><link rel="prefetch" href="/assets/js/103.3250c02d.js"><link rel="prefetch" href="/assets/js/104.29d7ed21.js"><link rel="prefetch" href="/assets/js/105.d7e9fbbd.js"><link rel="prefetch" href="/assets/js/106.1b5d8416.js"><link rel="prefetch" href="/assets/js/107.76dc1544.js"><link rel="prefetch" href="/assets/js/108.b3902295.js"><link rel="prefetch" href="/assets/js/109.d850dd61.js"><link rel="prefetch" href="/assets/js/11.60034940.js"><link rel="prefetch" href="/assets/js/110.a069f797.js"><link rel="prefetch" href="/assets/js/111.09024681.js"><link rel="prefetch" href="/assets/js/112.8b344d0d.js"><link rel="prefetch" href="/assets/js/113.d595799f.js"><link rel="prefetch" href="/assets/js/114.735747e0.js"><link rel="prefetch" href="/assets/js/115.4633d9d2.js"><link rel="prefetch" href="/assets/js/116.a13bf6e2.js"><link rel="prefetch" href="/assets/js/117.5ea5c11f.js"><link rel="prefetch" href="/assets/js/118.a476151d.js"><link rel="prefetch" href="/assets/js/119.5818c676.js"><link rel="prefetch" href="/assets/js/12.5bd43cd0.js"><link rel="prefetch" href="/assets/js/120.b161186b.js"><link rel="prefetch" href="/assets/js/121.b9f099e4.js"><link rel="prefetch" href="/assets/js/122.bc15ed2f.js"><link rel="prefetch" href="/assets/js/123.99d76580.js"><link rel="prefetch" href="/assets/js/124.c7ab2894.js"><link rel="prefetch" href="/assets/js/125.34cfb3f5.js"><link rel="prefetch" href="/assets/js/126.58a7e447.js"><link rel="prefetch" href="/assets/js/127.1c85bd46.js"><link rel="prefetch" href="/assets/js/13.66d25018.js"><link rel="prefetch" href="/assets/js/14.a25a4035.js"><link rel="prefetch" href="/assets/js/15.de39ab23.js"><link rel="prefetch" href="/assets/js/16.6d1bca0b.js"><link rel="prefetch" href="/assets/js/17.128d4594.js"><link rel="prefetch" href="/assets/js/18.0a3fd68b.js"><link rel="prefetch" href="/assets/js/19.b607c382.js"><link rel="prefetch" href="/assets/js/20.d31afd49.js"><link rel="prefetch" href="/assets/js/21.12acfd86.js"><link rel="prefetch" href="/assets/js/22.aadfbdc4.js"><link rel="prefetch" href="/assets/js/23.a0edc35a.js"><link rel="prefetch" href="/assets/js/24.b312e6df.js"><link rel="prefetch" href="/assets/js/25.97257d75.js"><link rel="prefetch" href="/assets/js/26.01936dd2.js"><link rel="prefetch" href="/assets/js/27.2e8828b4.js"><link rel="prefetch" href="/assets/js/28.e6790ba9.js"><link rel="prefetch" href="/assets/js/29.afc524f3.js"><link rel="prefetch" href="/assets/js/3.a9dffec4.js"><link rel="prefetch" href="/assets/js/30.aaf7c6de.js"><link rel="prefetch" href="/assets/js/31.9d65cff2.js"><link rel="prefetch" href="/assets/js/32.c894558d.js"><link rel="prefetch" href="/assets/js/33.8d8bd986.js"><link rel="prefetch" href="/assets/js/34.47facfd4.js"><link rel="prefetch" href="/assets/js/35.44ceb585.js"><link rel="prefetch" href="/assets/js/36.09f2f739.js"><link rel="prefetch" href="/assets/js/37.dbbc0e60.js"><link rel="prefetch" href="/assets/js/38.c1fad2a0.js"><link rel="prefetch" href="/assets/js/39.3ace24fd.js"><link rel="prefetch" href="/assets/js/4.2810ddf2.js"><link rel="prefetch" href="/assets/js/40.63374265.js"><link rel="prefetch" href="/assets/js/41.fd064420.js"><link rel="prefetch" href="/assets/js/42.57958530.js"><link rel="prefetch" href="/assets/js/43.c7cf35eb.js"><link rel="prefetch" href="/assets/js/44.e0cb951b.js"><link rel="prefetch" href="/assets/js/45.b223bdd3.js"><link rel="prefetch" href="/assets/js/46.c7b31626.js"><link rel="prefetch" href="/assets/js/47.3e4a6728.js"><link rel="prefetch" href="/assets/js/48.94b07616.js"><link rel="prefetch" href="/assets/js/49.fdf42941.js"><link rel="prefetch" href="/assets/js/5.e43498e1.js"><link rel="prefetch" href="/assets/js/50.cbed56b5.js"><link rel="prefetch" href="/assets/js/51.a18a4733.js"><link rel="prefetch" href="/assets/js/52.36cdbaf4.js"><link rel="prefetch" href="/assets/js/53.811cfd3f.js"><link rel="prefetch" href="/assets/js/54.83f3bd55.js"><link rel="prefetch" href="/assets/js/55.31ab89db.js"><link rel="prefetch" href="/assets/js/56.6c9598cc.js"><link rel="prefetch" href="/assets/js/57.d3a59dd5.js"><link rel="prefetch" href="/assets/js/58.4e4fc0d8.js"><link rel="prefetch" href="/assets/js/59.0266534d.js"><link rel="prefetch" href="/assets/js/6.8caa4cbe.js"><link rel="prefetch" href="/assets/js/60.d11b5ae3.js"><link rel="prefetch" href="/assets/js/61.741b1b34.js"><link rel="prefetch" href="/assets/js/62.20d137ff.js"><link rel="prefetch" href="/assets/js/63.8187c722.js"><link rel="prefetch" href="/assets/js/64.22cc7bfe.js"><link rel="prefetch" href="/assets/js/65.cc03ac65.js"><link rel="prefetch" href="/assets/js/66.cea322b8.js"><link rel="prefetch" href="/assets/js/67.72dd099a.js"><link rel="prefetch" href="/assets/js/68.f1b29a3d.js"><link rel="prefetch" href="/assets/js/69.77b58a41.js"><link rel="prefetch" href="/assets/js/7.87b373df.js"><link rel="prefetch" href="/assets/js/70.e6f55243.js"><link rel="prefetch" href="/assets/js/71.791e674e.js"><link rel="prefetch" href="/assets/js/72.38dfb769.js"><link rel="prefetch" href="/assets/js/73.bddf3f06.js"><link rel="prefetch" href="/assets/js/74.580447a5.js"><link rel="prefetch" href="/assets/js/75.13d0b306.js"><link rel="prefetch" href="/assets/js/76.2f8ecead.js"><link rel="prefetch" href="/assets/js/77.253ab4eb.js"><link rel="prefetch" href="/assets/js/78.eb589711.js"><link rel="prefetch" href="/assets/js/79.5b90567a.js"><link rel="prefetch" href="/assets/js/8.30d27849.js"><link rel="prefetch" href="/assets/js/80.bedfdf65.js"><link rel="prefetch" href="/assets/js/81.a68c6528.js"><link rel="prefetch" href="/assets/js/82.a37cd94a.js"><link rel="prefetch" href="/assets/js/83.8e32436f.js"><link rel="prefetch" href="/assets/js/84.ace16e95.js"><link rel="prefetch" href="/assets/js/85.86afda5c.js"><link rel="prefetch" href="/assets/js/86.fb04cb29.js"><link rel="prefetch" href="/assets/js/87.c58c2d4c.js"><link rel="prefetch" href="/assets/js/88.45337485.js"><link rel="prefetch" href="/assets/js/89.8b51f007.js"><link rel="prefetch" href="/assets/js/9.2d4820b7.js"><link rel="prefetch" href="/assets/js/90.6d9c1756.js"><link rel="prefetch" href="/assets/js/91.723d3e38.js"><link rel="prefetch" href="/assets/js/92.08564d2f.js"><link rel="prefetch" href="/assets/js/93.04edcdea.js"><link rel="prefetch" href="/assets/js/94.42a83ef8.js"><link rel="prefetch" href="/assets/js/95.46df9ab9.js"><link rel="prefetch" href="/assets/js/96.39a45b87.js"><link rel="prefetch" href="/assets/js/97.985d9133.js"><link rel="prefetch" href="/assets/js/98.879aeb93.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a32d750b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Sunflower</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/scattered/" class="nav-link">零散知识</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/Sunflowerjing/Sunflowerjing.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/scattered/" class="nav-link">零散知识</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/Sunflowerjing/Sunflowerjing.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Dev</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>三大框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>打包工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化&amp;性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>网络协议</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/HTTP 协议.html" class="sidebar-link">HTTP 协议</a></li><li><a href="/blog/输入网址后发生了什么.html" class="active sidebar-link">输入网址后发生了什么</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/输入网址后发生了什么.html#输入网址后发生了什么-2" class="sidebar-link">输入网址后发生了什么</a></li><li class="sidebar-sub-header"><a href="/blog/输入网址后发生了什么.html#输入网址后发生了什么-3" class="sidebar-link">输入网址后发生了什么</a></li><li class="sidebar-sub-header"><a href="/blog/输入网址后发生了什么.html#浏览器渲染流程" class="sidebar-link">浏览器渲染流程</a></li></ul></li><li><a href="/blog/代理.html" class="sidebar-link">代理</a></li><li><a href="/blog/http 缓存.html" class="sidebar-link">http 缓存</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="输入网址后发生了什么"><a href="#输入网址后发生了什么" class="header-anchor">#</a> 输入网址后发生了什么</h1> <p>参考文章：https://segmentfault.com/a/1190000013662126</p> <h2 id="输入网址后发生了什么-2"><a href="#输入网址后发生了什么-2" class="header-anchor">#</a> 输入网址后发生了什么</h2> <ol><li><p>输入网址并回车</p></li> <li><p>DNS域名解析</p></li> <li><p>建立TCP链接(客户端 - 服务端 - 客户端)</p></li> <li><p>浏览器发送 HTTP 请求</p></li> <li><p>服务器处理请求</p></li> <li><p>返回响应结果</p></li> <li><p>关闭TCP连接(客户端 - 服务端 - 服务端- 客户端)</p></li> <li><p>浏览器解析HTML</p> <ul><li>浏览器通过解析HTML，<code>生成DOM树</code></li> <li>解析CSS，<code>生成CSS规则树</code></li> <li>通过DOM树和CSS规则树生成<code>渲染树</code></li> <li>渲染树与DOM树不同，渲染树中并没有head、display为none等不必显示的节点。</li> <li>浏览器的解析过程并非是串连进行的，比如在解析CSS的同时，可以继续加载解析HTML，但在解析执行JS脚本时，会停止解析后续HTML，这就会出现阻塞问题。</li></ul></li> <li><p>浏览器布局渲染</p> <ul><li>根据渲染树布局，计算CSS样式，即每个节点在页面中的大小和位置等几何信息。</li> <li>HTML默认是流式布局的，CSS和js会打破这种布局，改变DOM的外观样式以及大小和位置。</li> <li>这时就要提到两个重要概念：repaint和reflow</li></ul> <blockquote><p>repaint：屏幕的一部分重画，不影响整体布局，比如某个CSS的背景色变了，但元素的几何尺寸和位置不变。
reflow： 意味着元件的几何尺寸变了，我们需要重新验证并计算渲染树。是渲染树的一部分或全部发生了变化。这就是Reflow，或是Layout。</p></blockquote></li></ol> <h2 id="输入网址后发生了什么-3"><a href="#输入网址后发生了什么-3" class="header-anchor">#</a> 输入网址后发生了什么</h2> <ol><li>www.baidu.com 回车</li> <li>找 IP
<ul><li>为什么: 请求是需要经过<strong>路由器</strong>的转发, 到达服务器。但是路由器只识别32(IPV4)/64(IPV6)位地址</li> <li>怎么找:
<ul><li>browser -&gt; 联通DNS -&gt; Root DNS(全量)</li> <li>域名 和 IP, 以 MAP 的形式进行存储。{domain: 10.10.10.164}</li> <li>此次没找到，去上一个 DNS 中找，找到后会缓存下来。</li> <li>浏览器先找本地缓存, 如果本地未找到, 则逐级查找 DNS 服务器。</li></ul></li></ul></li> <li>发请求
<ul><li>谁去发: 浏览器。本质是 OS 里面的一个进程</li> <li>怎么发:
<ul><li><p>client 和 server之间建立管道。<code>基于 ICP/IP 协议, 创建 socket 连接管道</code></p> <ul><li><code>Socket</code> 编程接口</li> <li>CP/IP也必须对外提供编程接口，这就是Socket。</li> <li>不同语言都有对应的建立Socket服务端和客户端的库</li></ul></li> <li><p>7层网络模型 OSI(Open System Interconnection)</p> <ul><li>自<code>上往下</code>分为: 应用层、表示层、会话层、传输层、网络层、数据链路层和物理层。</li> <li>HTTP 协议对应于应用层</li> <li>TCP、UDP协议对应于传输层</li> <li>IP协议对应于网络层</li></ul></li> <li><p>TCP/IP 怎么建立链接</p> <ul><li>建立: 三次握手</li> <li>断开: 四次挥手
<img src="%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.jpeg" alt="输入网址后发生了什么"> <strong>第一次握手</strong>：浏览器向服务器发送请求（SYN=1）,等待服务器确认 <br> <strong>第二次握手</strong>：服务器收到请求并确认，回复一个指令（SYN=1，ACK=1）<br> <strong>第三次握手</strong>：客户端收到服务器的回复指令，并返回确认（ACK=1）<br></li></ul> <p><strong>服务器返回html文档之后，浏览器的渲染引擎开始dom解析过程</strong></p> <p>完成了三次握手，客户端和服务器端就可以开始传送数据。以上就是TCP三次握手的总体介绍。通信结束客户端和服务端就断开连接，需要经过四次分手确认。<br></p> <p><strong>第一次分手</strong>：主机1（可以使客户端，也可以是服务器端），设置Sequence Number和Acknowledgment Number，向主机2发送一个FIN报文段；此时，主机1进入FIN_WAIT_1状态；这表示主机1没有数据要发送给主机2了；<br> <strong>第二次分手</strong>：主机2收到了主机1发送的FIN报文段，向主机1回一个ACK报文段，Acknowledgment Number为Sequence Number加1；主机1进入FIN_WAIT_2状态；主机2告诉主机1，我“同意”你的关闭请求；<br> <strong>第三次分手</strong>：主机2向主机1发送FIN报文段，请求关闭连接，同时主机2进入LAST_ACK状态；<br> <strong>第四次分手</strong>：主机1收到主机2发送的FIN报文段，向主机2发送ACK报文段，然后主机1进入TIME_WAIT状态；主机2收到主机1的ACK报文段以后，就关闭连接；此时，主机1等待2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，主机1也可以关闭连接了。<br></p></li> <li><p>HTTP 是什么？它和 TCP/IP 协议有什么不同</p> <ul><li>他们都是协议, 但是工作在不同的网络层</li> <li>关于TCP/IP和HTTP协议的关系，“我们在传输数据时，可以只使用(传输层)TCP/IP协议，但是那样的话，如果没有应用层，便无法识别数据内容。如果想要使传输的数据有意义，则必须使用到应用层协议。应用层协议有很多，比如HTTP、FTP、TELNET等，也可以自己定义应用层协议。</li></ul></li></ul></li></ul></li> <li>数据传输
<ul><li>client发送: request (path: /api/user. domain: www.baidu.com. Header session Cookie)</li> <li>server 处理请求: 服务端处理逻辑</li> <li>server 返回: response(header.body.Content-Type: html或application/json)</li></ul></li> <li>渲染
<ul><li>服务器返回<code>html文档</code>之后，浏览器的渲染引擎开始<code>dom解析</code>过程</li> <li><code>构建DOM树</code>--&gt; <code>渲染树(Render tree)</code> --&gt; <code>布局render树</code>--&gt; <code>绘制render树</code></li> <li>构建DOM树
<ul><li>渲染引擎会调用<code>html解析器</code>开始解析html，将html的标签<code>解析成dom树</code>，如果遇到静态资源，<code>link标签则去请求相应的资源</code>，遇到<code>script标签就会调用js引擎解释并执行</code></li> <li>解析dom树的过程：通过网络请求获取的html网页或资源从<code>字节流解码成字符流</code>，然后通过词法分析器解析成词语，之后经过<code>语法分析器构建成节点</code>，最后这些<code>节点组成一颗dom树</code>（当dom树构建完成之后，<code>webkit会触发DOMContentLoaded事件</code>，jquery的dom ready源码实现也用到这个事件，当所有资源全都加载完毕之后会触发onload事件）</li></ul></li> <li>渲染树(Render tree)
<ul><li>dom树解析完成之后，<code>渲染引擎</code>调用<code>css解释器</code>, 根据css规则为每个dom树节点计算css样式信息，<code>构建渲染树 (Render tree)</code></li> <li>render tree的过程：<code>渲染引擎调用css解释器</code>，根据css规则(解析外部或者内部引用额样式表)，解析出样式信息，构建render tree，渲染树会忽略掉不需要被渲染的元素(display:none,head,meta...)</li></ul></li> <li>布局树（render layer）
<ul><li>构建render tree之后，每个元素并不知道自己的大小颜色等样式和位置信息</li> <li>渲染引擎根据包含块和盒模型来计算元素的大小位置等信息，这就是布局计算（排版）。</li></ul></li> <li>绘制render树
<ul><li>绘制render树</li></ul></li></ul></li> <li>执行js、css</li></ol> <h2 id="浏览器渲染流程"><a href="#浏览器渲染流程" class="header-anchor">#</a> 浏览器渲染流程</h2> <ol><li><p>浏览器主要组件结构
<img src="%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%BB%E8%A6%81%E7%BB%84%E4%BB%B6%E7%BB%93%E6%9E%84.png" alt="浏览器渲染流程"></p></li> <li><p>渲染引擎——webkit和Gecko
<img src="%E6%B8%B2%E6%9F%93%E5%BC%95%E6%93%8E.png" alt="浏览器渲染流程"></p> <ul><li>Firefox使用Geoko —— <code>Mozilla</code>自主研发的渲染引擎。</li> <li>Safari和Chrome都使用 <code>webkit</code></li></ul></li> <li><p>关键渲染路径</p> <ul><li>关键渲染路径是指浏览器从最初接收请求来的 <code>HTML、CSS、javascript</code>等资源，然后<code>解析、构建树、渲染布局、绘制</code>，最后呈现给客户能看到的界面这整个过程。</li> <li>所以浏览器的渲染过程主要包括以下几步：
<ul><li>解析HTML生成DOM树</li> <li>解析CSS生成CSSOM规则树</li> <li>将DOM树与CSSOM规则树合并在一起生成渲染树</li> <li>遍历渲染树开始布局，计算每个节点的位置大小信息</li> <li>将渲染树每个节点绘制到屏幕</li></ul></li></ul></li> <li><p>构建DOM树</p> <ul><li>当浏览器接收到服务器响应来的HTML文档后，会遍历文档节点，生成DOM树。</li> <li>需要注意的是, DOM树的生成过程中可能会被JS的加载执行阻塞</li> <li>DOM树的生成过程中不会被CSS加载执行阻塞，CSS只阻塞了DOM的渲染而不会影响其生成</li></ul></li> <li><p>构建CSSOM规则树</p> <ul><li>浏览器解析CSS文件并生成CSS规则树，每个CSS文件都被分析成一个StyleSheet对象，每个对象都包含CSS规则。</li> <li>CSS规则对象包含对应于CSS语法的选择器和声明对象以及其他对象。</li> <li></li></ul></li> <li><p>渲染阻塞</p> <ul><li>当浏览器遇到一个 script 标记时，DOM 构建将暂停，直至脚本完成执行，然后继续构建DOM。每次去执行JavaScript脚本都会严重地阻塞DOM树的构建，如果JavaScript脚本还操作了CSSOM，而正好这个CSSOM还没有下载和构建，浏览器甚至会延迟脚本执行和构建DOM，直至完成其CSSOM的下载和构建。</li> <li>所以，script 标签的位置很重要。实际使用时，可以遵循下面两个原则
<ul><li>CSS 优先：引入顺序上，CSS 资源先于 JavaScript 资源。</li> <li>JS置后：我们通常把JS代码放到页面底部，且JavaScript 应尽量少影响 DOM 的构建。</li></ul></li> <li>当解析html的时候，会把新来的元素插入dom树里面，同时去查找css，然后把对应的样式规则应用到元素上，查找样式表是按照从右到左的顺序去匹配的。</li> <li>例如： div p {font-size: 16px}，会先寻找所有p标签并判断它的父标签是否为div之后才会决定要不要采用这个样式进行渲染）。
<ul><li>所以，我们平时写CSS时，尽量用id和class，千万不要过渡层叠。</li></ul></li></ul></li> <li><p>构建渲染树</p> <ul><li>通过DOM树和CSS规则树我们便可以构建渲染树。浏览器会先从DOM树的根节点开始遍历每个可见节点。对每个可见节点，找到其适配的CSS样式规则并应用。</li> <li>渲染树构建完成后，每个节点都是可见节点并且都含有其内容和对应规则的样式。这也是渲染树与DOM树的最大区别所在。渲染树是用于显示，那些不可见的元素当然就不会在这棵树中出现了，譬如。除此之外，display等于none的也不会被显示在这棵树里头，但是visibility等于hidden的元素是会显示在这棵树里头的。</li></ul></li> <li><p>渲染树布局</p> <ul><li>布局阶段会从渲染树的根节点开始遍历，然后确定每个节点对象在页面上的确切大小与位置，布局阶段的输出是一个盒子模型，它会精确地捕获每个元素在屏幕内的确切位置与大小。</li></ul></li> <li><p>渲染树绘制</p> <ul><li>在绘制阶段，遍历渲染树，调用渲染器的<code>paint()</code>方法在屏幕上显示其内容。渲染树的绘制工作是由浏览器的UI后端组件完成的。</li> <li>reflow与repaint：
<ul><li>根据渲染树布局，计算CSS样式，即每个节点在页面中的大小和位置等几何信息。HTML默认是流式布局的，CSS和js会打破这种布局，改变DOM的外观样式以及大小和位置。这时就要提到两个重要概念：replaint和reflow。</li> <li><code>replaint - 重画</code>：屏幕的一部分重画，不影响整体布局，比如某个CSS的背景色变了，但元素的几何尺寸和位置不变。</li> <li><code>reflow - 重排(回流)</code>： 意味着元件的几何尺寸变了，我们需要重新验证并计算渲染树。是渲染树的一部分或全部发生了变化。这就是Reflow，或是Layout。</li> <li>所以我们应该尽量减少reflow和replaint，我想这也是为什么现在很少有用table布局的原因之一。</li> <li>display:none 会触发 reflow，visibility: hidden属性并不算是不可见属性，它的语义是隐藏元素，但元素仍然占据着布局空间，它会被渲染成一个空框，所以visibility:hidden 只会触发 repaint，因为没有发生位置变化。</li> <li>有些情况下，比如修改了元素的样式，浏览器并不会立刻 reflow 或 repaint 一次，而是会把这样的操作积攒一批，然后做一次 reflow，这又叫异步 reflow 或增量异步 reflow。有些情况下，比如 resize 窗口，改变了页面默认的字体等。对于这些操作，浏览器会马上进行 reflow。</li></ul></li></ul></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/HTTP 协议.html" class="prev">HTTP 协议</a></span> <span class="next"><a href="/blog/代理.html">代理</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0c4e457a.js" defer></script><script src="/assets/js/2.3676e543.js" defer></script><script src="/assets/js/99.36965454.js" defer></script>
  </body>
</html>
