# 代码质量提升小结

**1、避免使用var来声明变量,应替换成let或者const**

~~~javascript
//bad
var a = 1;
var b = 2;

//good
const a = 1;
let b = 2;

//实际比较方便的案例
const ls = l.lengt
for(var i=0;i<ls;i++){}
for(let i=0;i<ls;i++){}
~~~

***注：var属于函数级作用域，存在变量提升问题，可以先使用后声明(值为undefined)，let和const属于块级作用域不存在变量提升，必须先声明后使用****



**2、对象操作的部分简化写法**

~~~javascript
function getName(){return 'ceshi'}
//bad
const obj = {
	a:1,
	b:2
}
obj[getName()] = 3

//good
const obj = {
	a:1,
	b:2,
	[getName()]:3
}
~~~

~~~javascript
//bad
const obj = {
	a:1,
	b:function(name){
		return name
	}
}

//good
const obj = {
	a:1,
	b(name){
		return name
	}
}
~~~

~~~javascript
//bad
const obj = {
	nums:nums,
	anums:1
}

//good 
const obj = {
	nums,
	anums:1
}
~~~

~~~javascript
//对对象属性进行过滤
const {name,sex,...rest} = person
~~~



**3、注意对逻辑进行容错**

+ **对重要的逻辑块添加try-catch**

如：JSON.parse、Array.prototype.split()、请求

对于try-cache既可以做容错处理，又可以做异常处理，***容错处理***主要保证页面不会因执行错误崩溃，这类问题是代码层bug，是可以预测的，而***异常处理***则是发生在部分接口请求逻辑中，如：数据库挂了、网络异常，这一类的问题是不可预测的

+ **使用数据的某个属性时应添加数据容错处理**

如：

~~~javascript
const obj = null/undefined
console.log(obj.name) //报错
~~~

通常处理的方式可以如下：

~~~javascript
const obj = null/undefined
console.log(obj&&obj.name)
~~~

由此牵引出的兼容写法

~~~javascript
/***&&***/
a&&b如果最终的结果是逻辑true的话，那么将返回最后一个真值，如果过是逻辑false，那么返回第一个逻辑false的值
例如：
1&&2&&3 ---> 3
1&&0&&3 ---> 0
undefined&&1&&3 ---> undefined
0&&undefined&&3 ---> 0

/***||***/
a||b如果a和b中存在真值那么将返回第一个真值，如果不存在那么将返回最后一个逻辑false的值
例如：
1||2||3 ---> 1
1||0||3--->1
undefined||1||3 ---> 1
0||undefined||null ---> null
~~~

+ **常用的三目运算符(Boolean ? a : b)进行容错**



**4、尊重项目文件结构**

我们开发很多情况下是在已有的项目下进行的，这种项目本身有自己的构建体系，我们应该在了解项目文件结构的情况下进行开发，防止加大后期的代码维护成本



**5、js中的魔术字符串**

~~~javascript
//bad
function example(user){
  const result = {}
	switch(user){
		 case 'jiang':
		 		result.sex = 'boy'
		 		break;
		 case 'xiao':
		 		result.sex = 'girl'
		 		break;
		 	...
	}
	
	if(user === 'jiang'){
		 result.group = 'fe'
	}else{
		 result.group = 'pm'
	}
}

//good
const USERS = {
	JIANG:'jiang',
	XIAO:'xiao'
}
const GROUP = {
	FE:'fe',
	PM:'pm'
}

function example(user){
  const result = {}
	switch(user){
		 case USERS.JIANG:
		 		result.sex = 'boy'
		 		break;
		 case USERS.XIAO:
		 		result.sex = 'girl'
		 		break;
		 	...
	}
	
	if(user === USERS.JIANG){
		 result.group = GROUP.FE
	}else{
		 result.group = GROUP.PM
	}
}
~~~



**6、提取公共方法，格式入口数据**

~~~javascript
//bad
const a = {name: 'xiao', sex: 'girl'}
const b = {userName: 'jiang', userSex: 'boy'}

function example(person){
	if(person && person.name){
			return person.sex
	}
}

function example_other(person){
	if(person && person.userName){
			return person.userSex
	}
}

//good
const a = {name: 'xiao', sex: 'girl'}
const b = {userName: 'jiang', userSex: 'boy'}

function personFormat(person){
	const {name,sex} = person
	return {
		name: name || person.userName,
		sex: sex || person.userSex
	}
}

function example(personFormat(person)){
	if(person && person.name){
			return person.sex
	}
}
~~~



**7、设计模式—策略模式**

~~~javascript
//bad
const feFun = (base) => {
	return base*3
}
const pmFun = (base) => {
	return base*2
}
function getNums(group, base){
	if(group === 'fe'){
		return feFun(base)
	}
	if(group === 'pm'){
		return pmFun(base)
	}
}
console.log(getNums('fe',3))

//good
const GROUP = {
	FE: 'fe',
	PM: 'pm'
}
const groupFun = {
	[GROUP.FE](base){
		return base*3
	}
	[GROUP.PM](base){
		return base*2
	}
}
function getNums(group, base){
	retrun groupFun[group](base)
}
console.log(etNums('fe',3))
~~~



**8、关于dom节点的class**

~~~javascript
//bad
const baseForces = true
const activeForces = true
let resultClass = ''
if(baseForces){resultClass += 'baseForces'}
if(activeForces){resultClass += 'activeForces'}
<div className={resultClass}></div>

//good
import classnames from 'classnames'

const baseForces = true
const activeForces = true

const resultClass = classnames({
	'baseForces': baseForces
	'activeForces': activeForces
})
<div className={resultClass}></div>
~~~



**9、良好的注释习惯**

~~~javascript
/**
 * 根据颜色排序
 * @param cArr 颜色数组
 * @param series chart-Series
 * @param metricsIds 指标名
 */
export function colorsOrderData(cArr, series, metricsIds) {
  if (!cArr || cArr.length < 1) return series.map(c => c.name)
  const names = Object.keys(cArr[0].config.values)
  ...
}
~~~



