# 微信小程序图片上传、预览、删除

```
  // 选择图片点击
  chooseImage:function(){ 
    let that = this;
    wx.chooseImage({   // 从本地相册选择图片或使用相机拍照。
      count: 9, // 默认9,即最多上传9张
      sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
      sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
      success: function (res) {
        // 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片
        var tempFilePaths = res.tempFilePaths
        let imgs = that.data.imgs;
        for(let i =0; i < tempFilePaths.length; i++){
          imgs.push(tempFilePaths[i])
        }
        that.setData({
          imgs: imgs
        })
      }
    });
  },
  // 预览图片
  previewImage:function(e){
    let _index = e.currentTarget.dataset.index;  // 获取自定义数据
    let list = this.data.imgs;
    let current = list[_index]; 
    wx.previewImage({
      current: current, // 当前显示图片的http链接
      urls: list // 需要预览的图片http链接列表
    })
  },
  // 删除图片
  delImage:function(e){
    let _index = e.currentTarget.dataset.index;
    let previewImage = this.data.imgs;
    previewImage.splice(_index, 1);   // 删除图片
    this.setData({
      imgs: previewImage
    })
  },
  // 上传图片
  uploadImage:function(e){
    let imgs = this.data.imgs;
    const openId = this.data.openId;
    for (let i = 0; i < imgs.length; i++){
      wx.uploadFile({  // 将本地资源上传到服务器
        url: 'https://192.168.1.10:9000/RegisteruserCtr/pois?v=1', //接口地址
        method: 'POST',
        header: {
          'content-type': 'multipart/form-data',
          openId
        },
        filePath: imgs[i],  // 要上传文件资源的路径
        name: 'nameKey',    // 文件对应的 key，开发者在服务端可以通过这个 key 获取文件的二进制内容
        success: function (res) {
          if(res.status === 0){
            wx.showToast({  // 显示消息提示框
              title: '上传成功',
              icon: 'success',
              duration: 2000
            })
          }else{
            wx.showToast({
              title: '上传失败',
              icon: 'none',
              duration: 2000
            })
          }
        }
      })
    }
    this.setData({
      layer: !this.data.layer,   // 关闭蒙层
      imgs: []  // 清空显示数据
    });
    wx.showTabBar({
      animation: true
    });
  }
```


## 小程序实现保存网络图片到本地
```
 wx.getSetting({
    success(res) {
        wx.downloadFile({
        url:"http://mss.sankuai.com/v1/mss_51a7233366a4427fa6132a6ce72dbe54/newsPicture/05558951-de60-49fb-b674-dd906c8897a6",
            success: function(res) {
                console.log(res);
                wx.saveImageToPhotosAlbum({
                    filePath: res.tempFilePath,
                    success: function(data) {
                        wx.showToast({
                            title: "保存成功",
                            icon: "success",
                            duration: 2000
                        });
                    },
                    fail: function(err) {
                        console.log(err);
                    },
                    complete(res) {
                        console.log(res);
                    }
                });
            }
        });
    }
});
```
 
## 读文件中的内容
```
读文件的时候需要注意。js、wxss、json、wxml, 这些都是保留后缀，不支持读取。

const FileSystemManager = wx.getFileSystemManager();
// readFileSync  readFile
FileSystemManager.readFile({ //读文件
// filePath: wx.env.USER_DATA_PATH + "/" + 'pages/index/fileName.txt',
    filePath: '/pages/index/fileName.txt',
    encoding: 'utf-8',
    success(res) {
        if (res.data) {
        let obj = JSON.parse(res.data);
        console.log('成功数据', obj);
        }
    },
    fail(err) {
        console.log('读取失败', err)
    }
})
```