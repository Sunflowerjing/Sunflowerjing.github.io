# 微信小程序基础概念

* `wx:if` 和 `hidden` 都可以用来做判断:
  * `hidden` 无论是否为真，都会渲染到页面中。`wx:if` 相应的则不会被渲染到页面中。





1. `bindtap`触发的点击函数, 里面的`dataset`属性,可以获取到组件节点中附加一些自定义数据。
```
wxml文件
<view data-alpha-beta="1" data-alphaBeta="2" bindtap="bindViewTap"> DataSet Test </view>

js文件
Page({
  bindViewTap:function(event){
    event.currentTarget.dataset.alphaBeta === 1 //  大写会转为小写
    event.currentTarget.dataset.alphabeta === 2 //  - 会转为驼峰写法
  }
})
```

## 目录结构
1. 小程序包含一个**描述整体程序的 app** 和多个**描述各自页面的 page**。
2. 一个**小程序主体**部分由三个文件组成，必须放在项目的根目录，如下：
    - app.js(小程序逻辑)
    - app.json(小程序公共配置, 例如页面入口)  在微信开发者工具中，打开小程序的**项目目录**中，必须包含app.json。即 **src > pages、app.json**，打开 src 文件夹。
    - app.wxss(小程序公共样式表)
3. 一个**小程序页面**由四个文件组成，分别是：
    - .js(页面逻辑) 
    ```
    JS 只需要管理状态即可:  this.setData({ msg: "Hello World" })

    页面(page)中的 js: Page({})
    组件(components)中的 js: Component({})
    APP 中的 js: App({})
    ```
    - .wxml(页面结构) 
    ```
    WXML 是这么写:  <text>{{msg}}</text>
    ```
    - .json(页面配置) 
    - .wxss(页面样式表)
    - **注意：为了方便开发者减少配置项，描述页面的四个文件必须具有相同的路径与文件名。**

## 注册小程序(app.js)
1. 每个小程序都需要在 app.js 中调用 App 方法注册小程序实例。**App(Object object)**, 接受一个 Object 参数，其指定小程序的生命周期回调等。**App() 必须在 app.js 中调用，必须调用且只能调用一次。不然会出现无法预期的后果。**
2. 绑定生命周期回调函数、错误监听和页面不存在监听函数等。
```
// app.js
App({
  onLaunch (options) {
    // 生命周期回调——监听小程序初始化完成时触发，全局只触发一次。
  },
  onShow (options) {
    // 生命周期回调——监听小程序启动或切前台。
  },
  onHide () {
    // 生命周期回调——监听小程序切后台。
  },
  onError (msg) {
    console.log(msg);  // 错误监听函数。
  },
  onPageNotFound() {
      // 页面不存在监听函数。
  },
  onUnhandledRejection() {
      // 未处理的 Promise 拒绝事件监听函数。
  },
  onReachBottom: function() {
    // 监听用户上拉触底事件
  },
  globalData: 'I am global data'
})
```
3. 整个小程序只有一个 App 实例，是全部页面共享的。
4. 开发者可以通过 getApp 方法获取到全局唯一的 App 实例
5. 获取App上的数据或调用开发者注册在 App 上的函数。
```
const appInstance = getApp()
console.log(appInstance.globalData) // I am global data
```

## 组件
1. 组件中的 .js 写法
```
Component({
    // 组件的对外属性，是属性名到属性设置的映射表
    properties: {   
        myProperty: { // 属性名
            type: String,  // 属性的类型
            value: ''    // 属性的初始值
        },
        myProperty2: String // 简化的定义方式
    },
    // 组件的内部数据，和 properties 一同用于组件的模板渲染
    data: {

    },
    // 组件的方法
    methods: {
        click() {
            // 组件之间的通信 
            this.triggerEvent('page中bind后面的事件名，例如: bind:searchList123',则为: searchList123。);
        }
    }
})
```
2. 组件触发页面中的方法，用 **this.triggerEvent('页面中 bind 后面的名字')**。重点
3. 在组件的.json 文件中,写入以下内容
```
{
    "component": true
}
```
4. 在引入组件的页面中,.json 应该如下配置
```
{
  "usingComponents": {
        "SearchBar": "/components/searchBox/searchBox",
  }
}
```
5. 若要使用微信的扩展组件，即 WeUI 组件库, 需要下载https://developers.weixin.qq.com/miniprogram/dev/extended/weui/download.html


##  控制 tabBar, 显示或者隐藏
```
1. 显示
wx.showTabBar({
    animation: true   // 动画
});
2. 隐藏
wx.hideTabBar({
    animation: true
});
```

## input标签
```
1. bindfocus: 输入框聚焦时触发
2. bindinput: 键盘输入时触发
3. bindconfirm: 点击完成按钮时触发
4. bindblur: 输入框失去焦点时触发

以上方法，都会有event.detail={}参数
```

## Storage
1. wx.setStorage({})。将数据存储在本地缓存中指定的 key 中。会覆盖掉原来该 key 对应的内容。
```
wx.setStorage({
   key: 'openId',
   data:" 123456789"
})
```
2. wx.getStorage({})。从本地缓存中异步获取指定 key 的内容。
```
wx.getStorage({
  key: 'openId',
  success (res) {
    console.log(res.data)
  }
})
```


## 用户ID(包括openid和unionid)
1. `openId`是来区分`用户唯一标识`。
2. openid`同一个应用`（App、公众号、小程序）的`同一个用户`有`唯一的openid`。
3. 如果开发者`拥有多个移动应用、网站应用、和公众帐号（包括小程序）`, 可通过 `UnionID `来区分用户的唯一性，`因为只要是同一个微信开放平台帐号下的移动应用、网站应用和公众帐号（包括小程序）`，用户的 UnionID 是唯一的。换句话说，`同一用户，对同一个微信开放平台下的不同应用，unionid是相同的`。
4. 同一个用户，在你的多个应用中，`openid`可能都不相同；但是，`unionid`一定会相同的。


## 预览图片
1. wx.previewImage({})
在新页面中全屏预览图片。预览的过程中用户可以进行保存图片、发送给朋友等操作。
```
wx.previewImage({
  current: '', // 当前显示图片的http链接
  urls: [] // 需要预览的图片http链接列表
})
```

## 获取 openID
```
wx.login({
    success: function(res){
        wx.request({
            url: '请求后端',  //接口地址
            method: 'POST',
            header: {
                'content-type': 'applicaiton/x-www-form-urlencoded' // 默认值 application/json
            },
            data: {
                code:res.code, //微信下发临时登录凭证
            },
            success: function (openIDRes) {
                console.log(openIDRes);
                if(openIDRes.status === 0){
                    wx.setStorage({
                        key: 'openId',
                        data: openIDRes.data.openId
                    })
                }
            }
        })
    }
})
```






