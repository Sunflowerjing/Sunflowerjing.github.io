# 微信小程序基础概念


## 目录结构
1. 小程序包含一个**描述整体程序的 app** 和多个**描述各自页面的 page**。
2. 一个**小程序主体**部分由三个文件组成，必须放在项目的根目录，如下：
    - app.js(小程序逻辑)
    - app.json(小程序公共配置, 例如页面入口)  在微信开发者工具中，打开小程序的**项目目录**中，必须包含app.json。即 **src > pages、app.json**，打开 src 文件夹。
    - app.wxss(小程序公共样式表)
3. 一个**小程序页面**由四个文件组成，分别是：
    - .js(页面逻辑) 
    ```
    JS 只需要管理状态即可:  this.setData({ msg: "Hello World" })

    页面(page)中的 js: Page({})
    组件(components)中的 js: Component({})
    APP 中的 js: App({})
    ```
    - .wxml(页面结构) 
    ```
    WXML 是这么写:  <text>{{msg}}</text>
    ```
    - .json(页面配置) 
    - .wxss(页面样式表)
    - **注意：为了方便开发者减少配置项，描述页面的四个文件必须具有相同的路径与文件名。**

## 注册小程序(app.js)
1. 每个小程序都需要在 app.js 中调用 App 方法注册小程序实例。**App(Object object)**, 接受一个 Object 参数，其指定小程序的生命周期回调等。**App() 必须在 app.js 中调用，必须调用且只能调用一次。不然会出现无法预期的后果。**
2. 绑定生命周期回调函数、错误监听和页面不存在监听函数等。
```
// app.js
App({
  onLaunch (options) {
    // 生命周期回调——监听小程序初始化完成时触发，全局只触发一次。
  },
  onShow (options) {
    // 生命周期回调——监听小程序启动或切前台。
  },
  onHide () {
    // 生命周期回调——监听小程序切后台。
  },
  onError (msg) {
    console.log(msg);  // 错误监听函数。
  },
  onPageNotFound() {
      // 页面不存在监听函数。
  },
  onUnhandledRejection() {
      // 未处理的 Promise 拒绝事件监听函数。
  },
  globalData: 'I am global data'
})
```
3. 整个小程序只有一个 App 实例，是全部页面共享的。
4. 开发者可以通过 getApp 方法获取到全局唯一的 App 实例
5. 获取App上的数据或调用开发者注册在 App 上的函数。
```
const appInstance = getApp()
console.log(appInstance.globalData) // I am global data
```

## 组件
1. 组件中的 .js 写法
```
Component({
    // 组件的对外属性，是属性名到属性设置的映射表
    properties: {   
        myProperty: { // 属性名
            type: String,  // 属性的类型
            value: ''    // 属性的初始值
        },
        myProperty2: String // 简化的定义方式
    },
    // 组件的内部数据，和 properties 一同用于组件的模板渲染
    data: {

    },
    // 组件的方法
    methods: {
        click() {
            // 组件之间的通信 
            this.triggerEvent('page中bind后面的事件名，例如: bind:searchList123',则为: searchList123。);
        }
    }
})
```
2. 组件触发页面中的方法，用 **this.triggerEvent('页面中 bind 后面的名字')**。重点


## 将图片上传到服务器
```
// 点击按钮
chooseImg: function() {  // 从本地相册选择图片
    const _this = this;
    wx.chooseImage({
        count: 1, // 最多可以选择的图片张数
        sizeType: ['original'],  // 所选的图片的尺寸
        sourceType: ['album'],  // 选择图片的来源
        success: function (res) {
            // tempFilePath可以作为img标签的src属性显示图片
            const tempFilePaths = res.tempFilePaths;
            // 将图片上传到服务器
            wx.uploadFile({
            url: 'https://example.weixin.qq.com/upload', //仅为示例，非真实的接口地址
            filePath: tempFilePaths[0],
            name: 'file',
            formData: {
                'user': 'test'
            },
            success (res){
                const data = res.data; // 开发者服务器返回的数据
                _this.setData({
                info: data
                });
                // console.log('返回数据', data);
            }
            })
        },
        fail: function(){
            console.log('调用接口失败');
        }
    });
}
```


## 小程序实现保存网络图片到本地
```
 wx.getSetting({
    success(res) {
        wx.downloadFile({
        url:"http://mss.sankuai.com/v1/mss_51a7233366a4427fa6132a6ce72dbe54/newsPicture/05558951-de60-49fb-b674-dd906c8897a6",
            success: function(res) {
                console.log(res);
                wx.saveImageToPhotosAlbum({
                    filePath: res.tempFilePath,
                    success: function(data) {
                        wx.showToast({
                            title: "保存成功",
                            icon: "success",
                            duration: 2000
                        });
                    },
                    fail: function(err) {
                        console.log(err);
                    },
                    complete(res) {
                        console.log(res);
                    }
                });
            }
        });
    }
});
```
 
## 读文件中的内容
```
读文件的时候需要注意。js、wxss、json、wxml, 这些都是保留后缀，不支持读取。

const FileSystemManager = wx.getFileSystemManager();
// readFileSync  readFile
FileSystemManager.readFile({ //读文件
// filePath: wx.env.USER_DATA_PATH + "/" + 'pages/index/fileName.txt',
    filePath: '/pages/index/fileName.txt',
    encoding: 'utf-8',
    success(res) {
        if (res.data) {
        let obj = JSON.parse(res.data);
        console.log('成功数据', obj);
        }
    },
    fail(err) {
        console.log('读取失败', err)
    }
})
```


## 



